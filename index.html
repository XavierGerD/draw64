<!DOCTYPE html>
<html>
  <head>
    <title>Draw64</title>
    <style>
      body {
        display: flex;
        gap: 20px;
      }

      #random {
        height: 2em;
      }

      #palette {
        display: flex;
        flex-direction: column;
        gap: 5px;
      }

      .palette-button {
        width: 30px;
        height: 30px;
        border-radius: 15px;
        position: relative;
      }

      .palette-button.selected {
        border: 1px solid black;
      }

      .palette-button.selected::before {
        content: "";
        border: 1px solid white;
        border-radius: 15px;
        position: absolute;
        top: 0;
        left: 0;
        width: 28px;
        height: 28px;
      }
    </style>
    <script src="static/palette.js"></script>
    <script src="static/canvas.js"></script>
  </head>
  <body>
    <canvas
      style="width: 640px; height: 640px"
      id="canvas"
      width="1280"
      height="1280"
    ></canvas>
    <div id="palette"></div>
    <button id="random">Send a heart!</button>
    <ul id="messages"></ul>
    <script>
      const baseURL = location.origin.replace("http:", "ws:");
      const ws = new WebSocket(`${baseURL}/ws/images/img1`);

      ws.onmessage = (event) => {
        const data = JSON.parse(event.data);
        data.event.command.values.forEach(([x, y, r, g, b]) => {
          const canvas = document.getElementById("canvas");
          const ctx = canvas.getContext("2d");
          ctx.fillStyle = `rgb(${r}, ${g}, ${b})`;
          ctx.fillRect(
            x * squareSize * dpr,
            y * squareSize * dpr,
            squareSize * dpr,
            squareSize * dpr
          );
        });
      };

      const sendMessage = (event) => {
        const input = document.getElementById("messageText");
        ws.send(input.value);
        input.value = "";
        event.preventDefault();
      };
    </script>
  </body>
</html>
